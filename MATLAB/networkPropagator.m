% Solve IF network using matlab

function f = networkPropagator(t,X,zone,alpha,beta_left,beta_centre,beta_right,...
                gamma_centre,tau,tau_h,gh,gs,I,V_r,N)
  v0 = X(1:N);
  n0 = X(N+1:2*N);
  u0 = X(2*N+1:3*N);
  y0 = X(3*N+1:4*N);
  r0 = X(4*N+1:5*N);
  
  fv = V_r*(zone==4)...
    +(mod(zone,2)).*(v0*exp(-t/tau)...
  +((beta_left*(zone==1)+beta_right*(zone==3))*gh*(tau-tau_h+tau_h*exp(-t/tau_h)))/(tau-tau_h)...
  -((beta_left*(zone==1)+beta_right*(zone==3))*gh*tau*exp(-t/tau))/(tau-tau_h)...
  -(gh*n0*tau_h*exp(-t/tau_h))/(tau-tau_h)...
  +(gh*n0*tau_h*exp(-t/tau))/(tau-tau_h)...
  +(gs*exp(-alpha*t).*(alpha*tau*u0-u0-alpha*t*y0+alpha*tau*y0+alpha^2*t*tau*y0))/(alpha*tau-1)^2 ...
  -(gs*exp(-t/tau)*(alpha*tau*u0-u0+alpha*tau*y0))/(alpha*tau-1)^2 ...
  -I+I*exp(-t/tau))...
  +(zone==2).*(1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))+tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))+tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))).*(-v0+(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*-2.0+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)+(beta_centre.*tau_h.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*-2.0+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)+(I.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(I.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(I.*tau_h.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(-gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(gs.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(beta_centre.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0)+(alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*(1.0./2.0))./tau+alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0)+(alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*(1.0./2.0))./tau+(I.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(I.*tau_h.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(I.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(gs.*tau_h.^2.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gs.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-(beta_centre.*tau_h.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))+(alpha.*gs.*tau_h.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./tau-(alpha.*gs.*tau_h.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./tau+(gs.*tau.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gs.*tau_h.^2.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)+(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))+(gs.*tau.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)).*(-1.0./2.0)+(1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(tau.^2.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-tau.^2.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))+tau_h.^2.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-tau_h.^2.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.*tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*2.0+tau.*tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*2.0).*(n0+(beta_centre.*tau.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(beta_centre.*tau.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+alpha.*gamma_centre.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*gamma_centre.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-(I.*gamma_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*2.0)./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(I.*gamma_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(gamma_centre.*gs.*tau.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gamma_centre.*gs.*tau.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)).*(1.0./4.0))./(gamma_centre.*tau));
  fn = (mod(zone,2)).*((beta_left*(zone==1)+beta_right*(zone==3))*(1-exp(-t/tau_h))+n0*exp(-t/tau_h))...
    +(~mod(zone,2)).*(1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h)).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))+tau_h.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))).*(n0+(beta_centre.*tau.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(beta_centre.*tau.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+alpha.*gamma_centre.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*gamma_centre.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-(I.*gamma_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*2.0)./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(I.*gamma_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(gamma_centre.*gs.*tau.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gamma_centre.*gs.*tau.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)).*(1.0./2.0)+(gamma_centre.*tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)-t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))-gamma_centre.*tau.*exp((t.*tau.*(-1.0./2.0)-t.*tau_h.*(1.0./2.0)+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(-v0+(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*-2.0+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)+(beta_centre.*tau_h.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*-2.0+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*2.0)+(I.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(I.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(I.*tau_h.^2.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(beta_centre.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(-gamma_centre.*(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+gamma_centre.*tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+gamma_centre.*tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))+(gs.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(beta_centre.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0)+(alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*(1.0./2.0))./tau+alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0)+(alpha.*gs.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*(1.0./2.0))./tau+(I.*tau.*tau_h.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0))./(tau.*tau_h.*2.0+tau.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+tau_h.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-tau.^2-tau_h.^2-gamma_centre.*gh.*tau.*tau_h.*4.0)+(I.*tau_h.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(I.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))-(gs.*tau_h.^2.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gs.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(beta_centre.*tau.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))-(beta_centre.*tau_h.^2.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))+(alpha.*gs.*tau_h.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0+tau.*tau_h.*exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(t.*tau+t.*tau_h-tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./tau-(alpha.*gs.*tau_h.*y0.*(tau.^2.*tau_h.^2.*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*4.0-tau.*tau_h.*exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h)).*1.0./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).^2.*(-t.*tau-t.*tau_h+tau.*tau_h.*2.0+t.*sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)+alpha.*t.*tau.*tau_h.*2.0).*2.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0).*(1.0./2.0))./tau+(gs.*tau.*tau_h.*u0.*(exp((t.*(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h-sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)-(gs.*tau_h.^2.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)+(beta_centre.*tau.*tau_h.*(exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))-1.0).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(gamma_centre.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)))+(gs.*tau.*tau_h.*u0.*exp(-alpha.*t).*(exp(alpha.*t)-exp((t.*(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)).*(1.0./2.0))./(tau.*tau_h))).*1.0./sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0))./(tau+tau_h+sqrt(tau.*tau_h.*-2.0+tau.^2+tau_h.^2+gamma_centre.*gh.*tau.*tau_h.*4.0)-alpha.*tau.*tau_h.*2.0)));
  fu = (u0+alpha*y0*t).*exp(-alpha*t);
  fy = y0*exp(-alpha*t);
  fr = (r0-t).*(r0>0.0);
  
  f = [ fv ; fn ; fu ; fy ; fr ];
  
end
